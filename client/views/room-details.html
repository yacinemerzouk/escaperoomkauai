<template name="room">

    <!-- HERO BANNER -->
    <div class="hero hero-home-bg" style="background-image: url({{image}});">
        <div class="overlay">
            <div class="content">
                <h1 style="margin: 0 0 20px">{{title}}</h1>
                <p style="width: 100%; max-width: 600px; margin: 0 0 20px;">{{description}}</p>
                <p style="width: 100%; max-width: 100%; margin: 0;">
                    <div class="specs">
                        <i class="fa fa-users" aria-hidden="true" style=""></i>
                        <span class="spec-value" style="">{{minPlayers}} - {{maxPlayers}}</span><br>
                        <span class="spec-key" style="">Players</span>
                    </div>
                    <div class="specs">
                        <i class="fa fa-clock-o" aria-hidden="true" style=""></i>
                        <span class="spec-value" style="">{{duration}}</span><br>
                        <span class="spec-key" style="">Minutes</span>
                    </div>
                    <div class="specs" style="width: 160px">
                        <i class="fa fa-trophy" aria-hidden="true"></i>
                        <span class="spec-value" style="">{{dynamicSuccessRate}}%</span><br>
                        <span class="spec-key" style="">Success Rate</span>
                    </div>
                    <div class="specs">
                        <i class="fa fa-credit-card" aria-hidden="true"></i>
                        <span class="spec-value" style="">${{kamaainaPerPlayer this}} - ${{pricePerPlayer}}</span><br>
                        <span class="spec-key" style="">Per Player</span>
                    </div>
                </p>
            </div>
        </div>
    </div>



    <!-- CONTENT -->
    <div class="container">

        <div class="row">

            <div class="col-xs-12 col-md-8">

                <!-- TITLE MAY CHANGE DEPENDING ON GAME AVAILABILITY -->
                <h3 id="booknow" class="subheading">{{#if available}}Book Now{{else}}{{#if retired}}Retired{{else}}Coming Soon{{/if}}{{/if}}</h3>

                <!-- BOOKING FORM -->
                <form class="" hook="reservation-form" style="background-color: #f0f0f0; padding: 30px; clear: both">

                    <div class="row">

                        <!-- PLAYER PRICING AND NB OF PLAYERS -->
                        <div class="col-xs-12">
                            {{#if reservation}}
                                {{#if reservation.room.available}}
                                    {{#with reservation}}
                                        <div class="form-group">
                                            <label for="nbPlayers">Select number of players</label>
                                            <p style="font-size: 14px; font-weight: bold;">{{toCurrency ../pricePerPlayer}} per player<br><span class="discount">{{toCurrency ../kamaainaDiscountPerPlayer}} off for each Hawaii resident</span></p>
                                            <select class="form-control" hook="update-players" id="nbPlayers" name="nbPlayers" style="width: 100%; max-width: 100%;">
                                                <option value="0">-- NUMBER OF PLAYERS --</option>
                                                {{#each nbPlayersOptions}}
                                                    <option value="{{this}}" {{selected this ../nbPlayers}}>{{this}} players</option>
                                                {{/each}}
                                            </select>
                                        </div>
                                    {{/with}}
                                {{/if}}
                            {{/if}}
                        </div>

                        <!-- DATE SELECTION -->
                        <div class="col-xs-12 col-md-6 {{#unless available}}hidden{{/unless}}">

                            <label for="Date" style="margin-bottom: 10px;">Select date <span class="label label-success pull-right" style="font-size: 14px; position: relative; top: 1px; background-color: #007300">{{humanReadableDate reservation.date}}</span></label>

                            <!-- DATEPICKER; HIDDEN IF DATE & TIME ALREADY SELECTED BY USER -->
                            <div id="datepicker" class="datepicker-full-width {{#if reservation.time}}hidden{{/if}}"></div>

                        </div>

                        <!-- TIME SELECTION -->
                        {{#if reservation}}
                            {{#if reservation.room.available}}
                                {{#with reservation}}

                                    <div class="col-xs-12 col-md-6">

                                        <label>Select time {{#if time}} <span class="label label-success pull-right" style="font-size: 14px; position: relative; top: 1px; background-color: #007300">{{time}}</span>{{/if}}</label>

                                        <div id="times">

                                            <!-- UNLESS TIME HAS ALREADY BEEN SELECTED BY USER -->
                                            {{#unless time}}

                                                <!-- LOOP OVER START TIMES -->
                                                {{#each startTimes}}

                                                        {{#if canBook ../roomId ../date this}}
                                                            <a href="#" hook="set-time" hook-data="{{this}}" class="label label-time {{#if hasEnoughSpots  ../roomId ../date this ../nbPlayers}}  label-time-green {{else}}  label-time-grey {{/if}}">{{this}} &nbsp;&bull;&nbsp; {{spotsLeft  ../roomId ../date this}}  spots left</a>
                                                        {{else}}
                                                            <span class="label label-time label-time-red">{{this}} &nbsp;&bull;&nbsp; Sold Out</span>
                                                        {{/if}}

                                                {{/each}}
                                            {{/unless}}

                                        </div>
                                    </div>

                                    <!-- SELECTED TIME & DATE; ONLY SHOWS IF BOTH CHOICES HAVE BEEN MADE BY USER -->
                                    <div class="col-xs-12">

                                        {{#if time}}

                                            <p style="text-align: center; margin-bottom: 25px;">
                                                <a href="#" hook="set-time" hook-data="" style="display: block; background-color: #ddd; padding: 8px 12px 12px; text-decoration: none">
                                                    <span style="font-size: 12px; font-weight: normal; color: #666; font-weight: bold">{{humanReadableDate date}} @{{time}}</span><br>
                                                    <span style="font-size: 12px; font-weight: normal; color: #cc0000;  text-decoration: underline; ">Change Date &amp; Time Choice</span>
                                                </a>
                                            </p>


                                            <!-- FIRST NAME -->
                                            <div class="form-group">
                                                <label for="firstName">First Name</label>
                                                <input type="text" hook="update-reservation" class="form-control" id="firstName" name="firstName" value="{{firstName}}">
                                            </div>

                                            <!-- LAST NAME -->
                                            <div class="form-group">
                                                <label for="lastName">Last Name</label>
                                                <input type="text" hook="update-reservation" class="form-control" id="lastName" name="lastName" value="{{lastName}}">
                                            </div>

                                            <!-- EMAIL -->
                                            <div class="form-group">
                                                <label for="email">Email</label>
                                                <input type="email" hook="update-reservation" class="form-control" id="email" name="email" value="{{email}}">
                                            </div>

                                            <!-- PHONE -->
                                            <div class="form-group">
                                                <label for="phone">Phone</label>
                                                <input type="text" hook="update-reservation" class="form-control" id="phone" name="phone" value="{{phone}}">
                                            </div>



                                            <!-- DISPLAY CLOSED ROOM OPTION IF APPROPRIATE -->
                                            {{#if canClose}}
                                                <div class="form-group">
                                                    <label>Close Room</label>
                                                    <p>Groups of 2-4 players can choose to pay a ${{room.priceToClose}} fee to keep players outside of their own party from reserving the same game and time slot. Groups of 5 or 6 players will never be joined by players outside of their own party.</p>

                                                    <div class="checkbox">
                                                        <label style="border-bottom: none">
                                                            {{#if closeRoom}}
                                                                <input hook="update-reservation" type="checkbox" id="closeRoom" name="closeRoom" checked> Yes, I want to pay a ${{room.priceToClose}} closed room fee.
                                                            {{else}}
                                                                <input hook="update-reservation" type="checkbox" id="closeRoom" name="closeRoom"> Yes, I want to pay a ${{room.priceToClose}} closed room fee.
                                                            {{/if}}
                                                            </label>
                                                    </div>
                                                </div>
                                            {{/if}}

                                            <!-- COUPON CODE -->
                                            <div class="form-group">
                                                <label for="coupon">Coupon Code</label>
                                                <p>If you have a coupon code, enter it here. Coupon codes cannot be combined with the Kama'aina discount.</p>
                                                <input type="text" hook="update-coupon" class="form-control" id="coupon" name="coupon" value="{{coupon}}">
                                                {{#if coupon}}
                                                    {{#if discount}}
                                                        <span class="label label-success">Coupon applied</span>
                                                    {{else}}
                                                        <span class="label label-danger">Enter valid coupon code</span>
                                                    {{/if}}
                                                {{/if}}
                                            </div>

                                            <!-- DISPLAY RESIDENT DISCOUNT OPTION IF NO COUPON CODE WAS USED. -->
                                            {{#unless discount}}
                                                <div class="form-group">
                                                    <label for="nbKamaaina">Kama'aina Discount</label>
                                                    <p>How many Hawai'i residents in your party? Hawai'i residents each get $5 off. HAWAII ID REQUIRED.</p>
                                                    <select class="form-control" hook="update-reservation" id="nbKamaaina" name="nbKamaaina" style="width: 100%">
                                                        <option value="0">-- SELECT NUMBER OF HAWAII RESIDENTS --</option>
                                                        {{#each kamaainaPlayersOptions}}
                                                            <option value="{{this}}" {{selected this ../nbKamaaina}}>{{this}}</option>
                                                        {{/each}}
                                                    </select>
                                                </div>
                                            {{/unless}}


                                            <!-- SOURCE TRACKING -->
                                            <div class="form-group">
                                                <label for="source">How did you hear about us?</label>
                                                <input type="text" hook="update-reservation" class="form-control" id="source" name="source" value="{{source}}">
                                            </div>


                                            <!-- REVIEW ORDER -->
                                            {{#if nbPlayers}}

                                                <label for="subtotal">Review Order</label>
                                                <table class="table table-striped table-bordered table-responsive">
                                                    <tbody>

                                                    <!-- NB PLAYERS / TIME / DATE -->
                                                    <tr>
                                                        <th colspan="2" style="font-size: 1.4em">
                                                            <span class="label label-success" style="position: relative; bottom: 3px; background-color: #007300">{{nbPlayers}} players</span>
                                                            <span class="label label-success" style="position: relative; bottom: 3px; background-color: #007300">{{humanReadableDate date}}</span>
                                                            <span class="label label-success" style="position: relative; bottom: 3px; background-color: #007300">{{time}}</span>
                                                        </th>
                                                    </tr>

                                                    <!-- COST OF PLAYERS -->
                                                    <tr>
                                                        <td>{{nbPlayers}} players &nbsp;&times;&nbsp; {{toCurrency room.pricePerPlayer}}</td>
                                                        <td class="currency">{{toCurrency costOfPlayers}}</td>
                                                    </tr>

                                                    <!-- COST OF CLOSED ROOM -->
                                                    {{#if canClose}}
                                                        {{#if closeRoom}}
                                                            <tr>
                                                                <td>Closed room</td>
                                                                <td class="currency">{{toCurrency costOfCloseRoom}}</td>
                                                            </tr>
                                                        {{/if}}
                                                    {{/if}}

                                                    <!-- SUBTOTAL BEFORE DISCOUNTS AND TAXES -->
                                                    <tr style="font-weight:bold;">
                                                        <td>Subtotal</td>
                                                        <td class="currency">{{toCurrency subtotal}}</td>
                                                    </tr>

                                                    <!-- DISCOUNT FROM KAMAAINA -->
                                                    {{#if discountKamaaina}}
                                                        <tr>
                                                            <td class="discount">Kama'aina Discount &nbsp;&bull;&nbsp; {{nbKamaaina}} residents &nbsp;&times;&nbsp; &mdash; {{toCurrency room.kamaainaDiscountPerPlayer}}</td>
                                                            <td class="currency discount">&mdash; {{toCurrency discountKamaaina}}</td>
                                                        </tr>
                                                    {{/if}}


                                                    <!-- DISCOUNT FROM COUPON CODE -->
                                                    {{#if discount}}
                                                        <tr>
                                                            {{#if couponData.type}}
                                                                <td class="discount text-uppercase">Coupon "{{couponData.coupon}}" ${{couponData.discount}} OFF</td>
                                                            {{else}}
                                                                <td class="discount text-uppercase">Coupon "{{couponData.coupon}}" {{couponData.discount}}% OFF</td>
                                                            {{/if}}
                                                            <td class="currency discount">&mdash; {{toCurrency couponData.discount}}</td>
                                                        </tr>
                                                    {{/if}}
                                                    <!-- TAXES -->
                                                    <tr>
                                                        <td>Taxes</td>
                                                        <td class="currency">{{toCurrency taxes}}</td>
                                                    </tr>

                                                    <!-- TOTAL -->
                                                    <tr style="font-size: 18px;">
                                                        <th>TOTAL</th>
                                                        <th class="currency">{{toCurrency total}}</th>
                                                    </tr>

                                                    </tbody>
                                                </table>

                                                <!-- CREDIT CARD FOR; IF TOTAL > 0 -->
                                                {{#unless isFree}}
                                                    <div class="row">

                                                        <!-- CREDIT CARD NUMBER -->
                                                        <div class="form-group col-xs-12 col-md-6">
                                                            <label for="cc">Credit Card Number</label>
                                                            <input type="text" hook="update-reservation" class="form-control" id="cc" name="cc" value="{{cc}}">
                                                        </div>

                                                        <!-- EXPIRATION -->
                                                        <div class="form-group col-xs-8 col-md-4">

                                                            <label for="ccExpMonth">Expiration</label>

                                                            <div class="row">
                                                                <div class="col-xs-6">
                                                                    <select hook="update-reservation" class="form-control col-xs-6" id="ccExpMonth" name="ccExpMonth">
                                                                        <option value="">Month</option>
                                                                        <option value="01" {{selected ccExpMonth '01'}}>01 - January</option>
                                                                        <option value="02" {{selected ccExpMonth '02'}}>02 - February</option>
                                                                        <option value="03" {{selected ccExpMonth '03'}}>03 - March</option>
                                                                        <option value="04" {{selected ccExpMonth '04'}}>04 - April</option>
                                                                        <option value="05" {{selected ccExpMonth '05'}}>05 - May</option>
                                                                        <option value="06" {{selected ccExpMonth '06'}}>06 - June</option>
                                                                        <option value="07" {{selected ccExpMonth '07'}}>07 - July</option>
                                                                        <option value="08" {{selected ccExpMonth '08'}}>08 - August</option>
                                                                        <option value="09" {{selected ccExpMonth '09'}}>09 - September</option>
                                                                        <option value="10" {{selected ccExpMonth '10'}}>10 - October</option>
                                                                        <option value="11" {{selected ccExpMonth '11'}}>11 - November</option>
                                                                        <option value="12" {{selected ccExpMonth '12'}}>12 - December</option>
                                                                    </select>
                                                                </div>
                                                                <div class="col-xs-6">
                                                                    <select hook="update-reservation" class="form-control col-xs-6" id="ccExpYear" name="ccExpYear">
                                                                        <option value="">Year</option>
                                                                        {{#each years}}
                                                                            <option value="{{this}}" {{selected ../ccExpYear this}}>{{this}}</option>
                                                                        {{/each}}
                                                                    </select>
                                                                </div>

                                                            </div>

                                                        </div>

                                                        <!-- CREDIT CARD VERIFICATION NUMBER -->
                                                        <div class="form-group col-xs-4 col-md-2">
                                                            <label for="cvv">CVV <a href="#"  data-toggle="modal" data-target="#myModal" hook="show-cvv-explainer" class="label label-info pull-right" style="color: #FFF; position: relative; top: 2px; text-decoration: none">?</a></label>
                                                            <input type="text" hook="update-reservation" class="form-control" id="cvv" name="cvv" value="{{cvv}}">
                                                        </div>

                                                        <!-- MODAL; EXPLAINER OF WHAT CVV IS -->
                                                        <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                                                            <div class="modal-dialog" role="document">
                                                                <div class="modal-content">
                                                                    <div class="modal-header">
                                                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                                                        <h4 class="modal-title" id="myModalLabel">CVV</h4>
                                                                    </div>
                                                                    <div class="modal-body">
                                                                        <p>CVV is a credit card verification number. You can find it on your credit card:</p>
                                                                        <img src="/images/cvv-explainer.png" style="width: 100%; max-width: 300px">
                                                                    </div>
                                                                    <div class="modal-footer">
                                                                        <button type="button" class="btn btn-default button" data-dismiss="modal">Close</button>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>

                                                    </div>
                                                {{/unless}}

                                                <!-- KACHING! -->
                                                <input type="submit" hook="checkout" class="button btn-block button-available text-center" value="Complete Order">

                                            {{/if}}


                                        {{/if}}
                                    </div>

                                {{/with}}
                            {{/if}}
                        {{/if}}


                    </div>

                    {{#if reservation}}

                        {{#unless reservation.room.available}}

                            <h3 style="margin-top: 0; font-size: 16px; color: #444; font-weight: bold;">{{#if retired}}This game had been retired.{{else}}Opening very soon!!!{{/if}}</h3>
                            <div id="datepicker" style="display: none"></div>

                            <!-- Begin MailChimp Signup Form -->
                            <div id="mc_embed_signup">
                                <form action="//escaperoomkauai.us13.list-manage.com/subscribe/post?u=2653aee4fbfd050c5eb64631b&amp;id=2381bdabff" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
                                    <div id="mc_embed_signup_scroll">
                                        <!--<h2 class="featurette-heading">Opening Very Soon!!!</h2>-->
                                        {{#if retired}}
                                            <p class="lead">This room is no longer available. It had a good run but it has now been decomissioned to make way for newer, better games. Please make a reservation for <a href="{{pathFor 'room' slug='mad-scientist'}}">The Missing Scientist</a>, which is now open, or one of our <a href="{{pathFor 'rooms'}}">other escape games</a>! You can also sign up for our newsletter to be notified of new games opening at Kauai Escape Room.</p>
                                        {{else}}
                                            <p class="lead">This room will be available in <strong>{{opening}}</strong>. In the meantime, you can make a reservation for <a href="{{pathFor 'room' slug='mad-scientist'}}">The Missing Scientist</a>, which is now open! You can also sign up for our newsletter to be notified of new games opening at Kauai Escape Room.</p>
                                        {{/if}}
                                        <div class="mc-field-group form-group">
                                            <label for="mce-EMAIL">Email Address </label>
                                            <input type="email" value="" name="EMAIL" class="form-control required email" id="mce-EMAIL">
                                        </div>
                                        <div class="mc-field-group form-group">
                                            <label for="mce-FNAME">First Name </label>
                                            <input type="text" value="" name="FNAME" class="form-control" id="mce-FNAME">
                                        </div>
                                        <div class="mc-field-group form-group">
                                            <label for="mce-LNAME">Last Name </label>
                                            <input type="text" value="" name="LNAME" class="form-control" id="mce-LNAME">
                                        </div>
                                        <div id="mce-responses" class="clear">
                                            <div class="response" id="mce-error-response" style="display:none"></div>
                                            <div class="response" id="mce-success-response" style="display:none"></div>
                                        </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
                                        <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_39a2a8b95a361766451ab131e_cd90eebeec" tabindex="-1" value=""></div>
                                        <div class="clear"><input type="submit" value="Sign Up For A Notification" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
                                    </div>
                                </form>
                            </div>
                            <!--End mc_embed_signup-->


                        {{/unless}}

                    {{else}}

                        ERROR. No room / reservation data.

                    {{/if}}
                </form>

                <!-- SECURE PADLOCK AND CREDIT CARD LOGOS BELOW FORM -->
                <div class="text-center">
                    <img src="/images/secure2.jpeg" style="margin-top: 20px; width: 100%; max-width: 200px">
                </div>
            </div>

            <!-- TESTIMONIALS -->
            <div class="col-xs-12 col-md-4 hidden-xs hidden-sm" style="padding-top: 140px;">

                {{#with settings}}
                    <p class="testimonial" style="margin-left: 0; margin-right:0; max-width: none; padding: 0; margin-bottom: 20px;">
                        <span class="testimonial-quote" style="font-size: 16px; line-height: 24px;">
                            "{{firstTestimonial}}"
                            </span><br>
                        <span class="testimonial-author" style="font-size: 14px; line-height: 22px;">
                             &mdash; {{firstCite}}
                        </span>
                    </p>
                    <p class="testimonial" style=" margin-left: 0; margin-right:0; max-width: none;  padding: 0; margin-bottom: 20px;">
                        <span class="testimonial-quote" style="font-size: 16px; line-height: 24px;">
                            "{{secondTestimonial}}"
                            </span><br>
                        <span class="testimonial-author" style="font-size: 14px; line-height: 22px;">
                             &mdash; {{secondCite}}
                        </span>
                    </p>
                {{/with}}

                <p>
                    <img src="/images/tripadvisor.jpg" style="width:100px;">
                </p>
                <p>
                    <img src="/images/yelp.png" style="width:100px; padding: 5px;">
                </p>
            </div>
        </div>
    </div>


    <!-- UI OVERLAY WHEN PROCESSING PAYMENT -->
    <div class="processing-bg">
        <div class="processing">
            PROCESSING ORDER<br><img style="position: relative; bottom: 10px; left: 1px" src="/images/loading.gif">
        </div>
    </div>

</template>